import requests
import base64
from dotenv import load_dotenv
import os

# Load the environment variables from the .env file
load_dotenv()

# Get the API key from the environment variable
api_key = os.getenv("api_key")

if not api_key:
    print("api_key not found in .env file.")
    exit(1)

# Prompt user for the number of results to display
try:
    num_results = int(input("Enter the number of results to display 10,20,50,100: "))
except ValueError:
    print("Invalid input. Please enter a valid number.")
    exit(1)

# Prompt user for the filename to save the results
file_name = input("Enter the filename to save the results (include .txt extension): ")

query = 'web.body="content=\Chamilo 1"'
encoded_query = base64.urlsafe_b64encode(query.encode("utf-8")).decode('ascii')
page = 10
page_size = num_results  # Use the user-specified number of results
start_time = '2023-01-01'
end_time = '2023-12-01'

url = f"https://api.hunter.how/search?api-key={api_key}&query={encoded_query}&page={page}&page_size={page_size}&start_time={start_time}&end_time={end_time}"

r = requests.get(url)  # or r = requests.get(url, verify=False)

if r.status_code == 200:
    # Display the results
    data = r.json()
    print(data)

    # Save the results to a file
    with open(file_name, 'w') as file:
        file.write(str(data))
    print(f"Results saved to {file_name}")
else:
    print(f"Request failed with status code: {r.status_code}")
